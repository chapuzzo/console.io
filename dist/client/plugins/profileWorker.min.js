function ScriptProfileNode(a,b){var c=dataTable[a]||["root",0,""];this.id=util.getUniqueId(),this.functionName=c[0],this.lineNumber=c[1],this.url=c[2],this.callUID=a,this.startTime=b,this.totalTime=0,this.selfTime=0,this.numberOfCalls=1,this.visible=!0,this.children=[]}function ScriptProfile(a){this.title=a,this.uid=store.length+1,this.head=new ScriptProfileNode(this.uid,Date.now()),this.active=!0,this.depth=0}function getActiveProfiles(){return util.filter(store,function(a){return!!a.active})}function getProfileByTitle(a){var b;return util.every(store,function(c){return!c.active||c.title!==a||(b=c,!1)}),b}var dataTable={},store=[],util={},indexMap={};util.noop=function(){},util.getUniqueId=function(){var a=0;return function(){return++a}}(),util.every=function(){return Array.prototype.every?function(a,b,c){return(a||[]).every(b,c)}:function(a,b,c){a=a||[];var d=0,e=a.length;if(e)do if(!b.call(c||a,a[d],d,a))return!1;while(++d<e);return!0}}(),util.filter=function(){return Array.prototype.filter?function(a,b,c){return(a||[]).filter(b,c)}:function(a,b,c){a=a||[];var d=0,e=a.length,f=[];if(e)do b.call(c||a,a[d],d,a)&&f.push(a[d]);while(++d<e);return f}}(),util.forEach=function(){return Array.prototype.forEach?function(a,b,c){(a||[]).forEach(b,c)}:function(a,b,c){a=a||[];var d=0,e=a.length;if(e)do b.call(c||a,a[d],d,a);while(++d<e)}}(),util.forEachProperty=function(a,b,c){var d;for(d in a)b.call(c||a,a[d],d,a)},util.extend=function(a,b){return util.forEachProperty(b,function(b,c){a[c]=b}),a},util.asyncForEach=function(a,b,c,d){a=[].concat(a||[]),util.asyncIteration(a,b||util.noop,c||util.noop,d)},util.asyncIteration=function(a,b,c,d){a.length>0?setTimeout(function(){b.call(d||a,a.shift(),function(){util.asyncIteration(a,b,c,d)})},4):c.call(d)},util.async=function(a,b){return setTimeout(function(){a.call(b)},4)},ScriptProfileNode.prototype.finish=function(a){this.adjustTime(Date.now()),util.async(a)},ScriptProfileNode.prototype.getNodeByCallerId=function(a){var b;return util.every(this.children,function(c){return c.callUID!==a||(b=c,!1)}),b},ScriptProfileNode.prototype.getActiveNode=function(){var a=this.children.length;return a>0?this.children[a-1]:null},ScriptProfileNode.prototype.adjustTime=function(a){if(this.totalTime=a-this.startTime,this.children.length>0){var b=0;util.forEach(this.children,function(a){b+=a.totalTime},this),b>this.totalTime&&(this.totalTime=b),this.selfTime=Math.abs(this.totalTime-b)}else this.selfTime=this.totalTime},ScriptProfileNode.prototype.begin=function(a,b){var c=this.getNodeByCallerId(a);c?++c.numberOfCalls:(c=new ScriptProfileNode(a,b),this.children.push(c))},ScriptProfileNode.prototype.end=function(a,b){var c=this.getNodeByCallerId(a);return!!c&&(c.adjustTime(b),!0)},ScriptProfile.prototype.finish=function(a){delete this.active,delete this.depth,this.head.finish(a)},ScriptProfile.prototype.toJSON=function(){this.head.finish(callback)},ScriptProfile.prototype.getActiveNode=function(a){var b=0,c=this.head;if(a="undefined"==typeof a?this.depth:a,a>0)do c=c.getActiveNode();while(a>++b);return c},ScriptProfile.prototype.begin=function(a,b,c){c&&(this.depth=0),indexMap[a]||(indexMap[a]=[]),indexMap[a].push(this.depth),this.getActiveNode().begin(a,b),this.depth++},ScriptProfile.prototype.end=function(a,b){if(this.depth--,indexMap[a]){var c=this.getActiveNode(indexMap[a].pop());c.end(a,b)||postMessage({type:"error",message:a+" failed to find node."})}else postMessage({type:"error",message:a+" depth index not mapped."})},onmessage=function(a){var b=a.data;switch(b.type){case"begin":util.forEach(getActiveProfiles(),function(a){a.begin(b.callId,b.time,b.reset)});break;case"end":util.forEach(getActiveProfiles(),function(a){a.end(b.callId,b.time)});break;case"start":store.push(new ScriptProfile(b.title));break;case"finish":var c=getProfileByTitle(b.title);c&&c.finish(function(){postMessage({type:"report",report:c})});break;case"load":util.forEachProperty(b.table,function(a){a.push(b.file)}),util.extend(dataTable,b.table);break;case"clear":store=[]}};